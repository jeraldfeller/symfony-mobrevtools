{% extends 'base.html.twig' %}
{% block stylesheets %}

{% endblock %}
{% block nav %}
    {{ render(controller(
    'AppBundle:Navmenu:getNavmenu'
    )) }}
{% endblock %}
{% block body %}
    <h1 class="page-title"> Settings

    </h1>
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <i class="icon-home"></i>
                <a href="/">Home</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <span>Tools</span>
             <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <span>{{ page }}</span>
            </li>

        </ul>
        <div class="page-toolbar">
            <div class="btn-group pull-right">
                <button type="button" class="btn btn-fit-height grey-salt dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true"> Actions
                    <i class="fa fa-angle-down"></i>
                </button>
                <ul class="dropdown-menu pull-right" role="menu">
                    <li>
                        <a href="#">
                            <i class="icon-bell"></i> Action</a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-shield"></i> Another action</a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-user"></i> Something else here</a>
                    </li>
                    <li class="divider"> </li>
                    <li>
                        <a href="#">
                            <i class="icon-bag"></i> Separated link</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- END PAGE HEADER-->
    <div class="row">
        <div class="col-lg-12">
            <div class="portlet light">
                <div class="portlet-title">
                    <div class="row">
                             <div id="appendLanders">

                             </div>

                             <div class="col-md-4 pull-left" >
                                <button class="btn blue" id="addLanderBtn"><i class="fa fa-plus"></i> Add Lander</button>
                                <button style="display: none;" class="btn blue" id="saveLander" class="btn btn-primary spinnerBtn ladda-button" data-style="expand-right" data-size="l"><span class="ladda-label">Save </span></button>
                            </div>

                    </div>
                    <br>
                </div>

                    <div class="portlet-body">

                        <div class="row">

                            <div class="col-lg-12">

                                    <table class="table table-striped table-bordered table-hover dt-responsive table-checkable order-column table-header-fixed" width="100%" id="datatable-responsive">
                                        <thead>
                                        <tr>
                                            <th>Lander Name </th>
                                            <th>Url </th>
                                            <th>Offer </th>
                                            <th>Geo </th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        </tbody>

                                    </table>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('assets/global/plugins/autosize/autosize.min.js') }}" type="text/javascript"></script>
    <script>
        Ladda.bind( '.spinnerBtn' );
    </script>
    <script>



        var i = 0;
        var data = {items:[]};
        $('#addLanderBtn').click(function(){
            $('#appendLanders').append(
            '<div id="appendDivHolder_'+i+'" style="padding-bottom: 50px;">' +
            '<div class="col-md-2 col-sm-6">' +
            '<input type="text" placeholder="Lander Name" class="form-control" id="lander_'+i+'">' +
            '</div>' +
            '<div class="col-md-4 col-sm-6">' +
            '<input type="text" placeholder="Lander Url" class="form-control" id="lander_url_'+i+'">' +
            '</div>' +
            '<div class="col-md-1 col-sm-6">' +
            '<input type="text" placeholder="1 Offer" class="form-control" id="lander_offer_'+i+'">' +
            '</div>' +
            '<div class="col-md-2 col-sm-6">' +
            '<select class="form-control" id="lander_geo_'+i+'">' +
            '<option value="Global">GEO</option>' +
                {% for country in countries %}
                '<option value="{{ country.code }}">{{ country.name }}</option>' +
                {% endfor %}
            '</select>' +
            '</div>' +
            '<div class="col-md-2 col-sm-6">' +
            '<select class="form-control" id="lander_presets_'+i+'" placeholder="Presets">' +
            '<option value="" disabled selected>Select Preset</option>' +
                {% for preset in presets %}
                '<option value="{{ preset.presets }}">{{ preset.presetName }}</option>' +
                {% endfor %}
            '</select>' +
            '</div>' +
            '<div class="col-md-1">' +
            '<button class="btn red" onclick="removeAppend(this)" data-index="'+i+'"><i class="fa fa-times"></i></button>' +
            '</div>' +
            '</div>'
            );

            data.items.push({

                landerName: 'lander_'+i,
                landerUrl:  'lander_url_'+i,
                landerOffer:'lander_offer_'+i,
                landerGeo:  'lander_geo_'+i,
                landerPresets: 'lander_presets_'+i
            });

            i++;

            if(i > 0){
                $('#saveLander').css('display', 'inline');
            }


        });

        $('#saveLander').on('click', function(){
            $btn = $(this)[0];
            $landerData = [];
            $.each(data, function(i, elem) {
                $.each(elem, function(obj, value) {
                    if(typeof value != 'undefined'){
                        $landerData.push({
                                    landerName: $('#' + value['landerName']).val(),
                                    landerUrl: $('#' + value['landerUrl']).val(),
                                    landerOffer: $('#' + value['landerOffer']).val(),
                                    landerGeo: $('#' + value['landerGeo']).val(),
                                    landerPresets: $('#' + value['landerPresets']).val()
                                }
                        )
                    }
                });
            });

            console.log($landerData);
            addLanders($btn, $landerData);
        });


        function removeAppend(elem){
            var index = elem.dataset.index;

            $('#appendDivHolder_'+index).fadeTo("fast",0.7, function(){
                $('#appendDivHolder_'+index).remove();
                delete data.items[index];

            });


        }



        $(document).on('ready', function() {

            var fixedHeaderOffset = 0;
            if (App.getViewPort().width < App.getResponsiveBreakpoint('md')) {
                if ($('.page-header').hasClass('page-header-fixed-mobile')) {
                    fixedHeaderOffset = $('.page-header').outerHeight(true);
                }
            } else if ($('.page-header').hasClass('navbar-fixed-top')) {
                fixedHeaderOffset = $('.page-header').outerHeight(true);
            } else if ($('body').hasClass('page-header-fixed')) {
                fixedHeaderOffset = 64; // admin 5 fixed height
            }
            var table = $('#datatable-responsive');
            var oTable = $('#datatable-responsive').DataTable({
                fixedHeader: {
                    header: true,
                    headerOffset: fixedHeaderOffset
                },
                "ajax": '/data_table_tmp_files/landers/landers.txt',
                responsive: {
                    details: {

                    }
                },
                "iDisplayLength": 20,
                "lengthMenu": [
                    [20, 500, 1000, -1],
                    [20, 500, 1000, "All"] // change per page values here
                ],
                "order": [[ 0, "asc" ]]
            });

            $('#addPresetsBtn').on('click', function(){
                $btn = $(this)[0];
                $presetName = $('#presetName').val();
                $items = $("#addPresets").val();

                $data = {
                    presetName: $presetName,
                    parameters: $items
                }



                addPresets($btn, $data);
            });

        });

        function pushData(elem){
            $('#editPresets').tagsinput('removeAll');
            $action = $(elem).data('action');
            $id = $(elem).data('id');
            $presetName = $(elem).data('name');
            $presets = $(elem).data('parameters');

            if($action == 'edit'){
                $('#editPresetId').val($id);
                $('#editPresetsName').val($presetName);
                $('#editPresets').tagsinput('add', $presets);
            }else if($action == 'delete'){

            }

        }

    </script>

    <!-- AJAX CALLS -->
    <script src="{{ asset('assets/ajax/landers/landers.js') }}" type="text/javascript"></script>
    <!-- END AJAX CALLS -->
{% endblock %}
