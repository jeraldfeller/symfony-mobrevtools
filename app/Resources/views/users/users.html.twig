{% extends 'base.html.twig' %}
{% block stylesheets %}
    <link href="{{ asset('assets/global/plugins/select2/css/select2.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/global/plugins/select2/css/select2-bootstrap.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/global/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css') }}" rel="stylesheet" type="text/css" />
    <link href="{{ asset('assets/global/plugins/clockface/css/clockface.css') }}" rel="stylesheet" type="text/css" />
    <style>
        .align-left{
            text-align: left !important;
            padding-left: 10px !important;
        }
    </style>
{% endblock %}
{% block nav %}
    {{ render(controller(
    'AppBundle:Navmenu:getNavmenu'
    )) }}
{% endblock %}
{% block body %}
    <h1 class="page-title"> {{ page }}

    </h1>
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <i class="icon-home"></i>
                <a href="/">Home</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <span>Global Settings</span>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <span>Manage Users</span>
                <i class="fa fa-angle-right"></i>
            </li>

            <li>
                <span>{{ page }}</span>
            </li>

        </ul>
        <div class="page-toolbar">
            <div class="btn-group pull-right">
                <button type="button" class="btn btn-fit-height grey-salt dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-delay="1000" data-close-others="true"> Actions
                    <i class="fa fa-angle-down"></i>
                </button>
                <ul class="dropdown-menu pull-right" role="menu">
                    <li>
                        <a href="#">
                            <i class="icon-bell"></i> Action</a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-shield"></i> Another action</a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="icon-user"></i> Something else here</a>
                    </li>
                    <li class="divider"> </li>
                    <li>
                        <a href="#">
                            <i class="icon-bag"></i> Separated link</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!-- END PAGE HEADER-->
    <div class="row">
        <div class="col-lg-12">
            <div class="portlet light">
                <div class="portlet-title">


                    <div class="row">
                        <div class="form-group">
                            <div class="col-md-4 col-xs-12">
                                <div class="caption font-dark">
                                    <button class="btn blue" data-toggle="modal" data-target="#modalAddUser"><i class="fa fa-plus"></i> Add User</button>
                                        <div class="modal fade" id="modalAddUser" tabindex="-1" role="basic" aria-hidden="true">
                                            <div class="modal-dialog modal-md">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title"><i class="fa fa-user"></i> Add User</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <div class="col-lg-12 col-md-12">
                                                                <h4>First Name</h4>
                                                                    <input type="text" id="firstName" class="form-control">
                                                                <h4>Last Name</h4>
                                                                    <input type="text" id="lastName" class="form-control">
                                                                <h4>Email</h4>
                                                                    <input type="email" id="email" class="form-control">
                                                                <h4>Password</h4>
                                                                <input type="password" id="password" class="form-control">
                                                                <h4>Enable</h4>
                                                                <input id="enabled" class="switch_btn" data-on-color="success" data-size="mini" data-off-color="danger" data-on-text="YES" data-off-text="NO" type="checkbox" value="1" name="switch">
                                                            </div>
                                                         </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
                                                        <button type="button" id="addUserBtn" class="btn blue ladda-button spinnerBtn" data-style="expand-right" data-size="l"><span class="ladda-label"><i class="fa fa-plus"></i> Add</span></button>
                                                    </div>
                                                </div>
                                                <!-- /.modal-content -->
                                            </div>
                                            <!-- /.modal-dialog -->
                                        </div>


                                        <div class="modal fade" id="modalEditUser" tabindex="-1" role="basic" aria-hidden="true">
                                            <div class="modal-dialog modal-md">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title"><i class="fa fa-edit"></i> Edit User</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <div class="col-lg-12 col-md-12">
                                                                <h4>First Name</h4>
                                                                    <input type="text" id="editFirstName" class="form-control">
                                                                <h4>Last Name</h4>
                                                                    <input type="text" id="editLastName" class="form-control">
                                                                <h4>Email</h4>
                                                                    <input type="email" id="editEmail" class="form-control">
                                                                <h4>Password</h4>
                                                                <input type="password" id="editPassword" class="form-control">
                                                                <h4>Enable</h4>
                                                                <input id="editEnabled" class="switch_btn" data-on-color="success" data-size="mini" data-off-color="danger" data-on-text="YES" data-off-text="NO" type="checkbox" value="1" name="switch">
                                                            </div>
                                                         </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <input type="hidden" id="editUid" class="form-control">
                                                        <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
                                                        <button type="button" id="editUserBtn" class="btn blue ladda-button spinnerBtn" data-style="expand-right" data-size="l"><span class="ladda-label"><i class="fa fa-save"></i> Update</span></button>
                                                    </div>
                                                </div>
                                                <!-- /.modal-content -->
                                            </div>
                                            <!-- /.modal-dialog -->
                                        </div>


                                        <div class="modal fade" id="modalDeleteUser" tabindex="-1" role="basic" aria-hidden="true">
                                            <div class="modal-dialog modal-sm">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h4 class="modal-title"><i class="fa fa-warning"></i> Warning</h4>
                                                    </div>
                                                    <div class="modal-body">
                                                        <div class="row">
                                                            <div class="col-lg-12 col-md-12">
                                                                <p>Are you sure do you want to remove <b><span id="userDeleteName"></span></b>?</p>
                                                            </div>
                                                         </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <input type="hidden" id="deleteUid" class="form-control">
                                                        <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
                                                        <button type="button" id="deleteUserBtn" class="btn blue ladda-button spinnerBtn" data-style="expand-right" data-size="l"><span class="ladda-label"><i class="fa fa-times"></i> Remove</span></button>
                                                    </div>
                                                </div>
                                                <!-- /.modal-content -->
                                            </div>
                                            <!-- /.modal-dialog -->
                                        </div>




                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                    <div class="portlet-body">

                        <div class="row">

                            <div class="col-lg-12">

                                    <table class="table table-striped table-bordered table-hover dt-responsive table-checkable order-column table-header-fixed" width="100%" id="datatable-responsive">
                                        <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Email </th>
                                            <th>Status</th>
                                            <th>Action</th>
                                        </tr>
                                        </thead>

                                        <tbody>
                                        </tbody>

                                    </table>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('assets/global/plugins/autosize/autosize.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/select2/js/select2.full.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/moment.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/clockface/js/clockface.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/pages/scripts/components-date-time-pickers.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/pages/scripts/components-bootstrap-switch.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js') }}"></script>
    <script>
        Ladda.bind( '.spinnerBtn' );
    </script>
    <script>
        $(document).on('ready', function() {


            $("input[type=checkbox].switch_btn").bootstrapSwitch();

            var fixedHeaderOffset = 0;
            if (App.getViewPort().width < App.getResponsiveBreakpoint('md')) {
                if ($('.page-header').hasClass('page-header-fixed-mobile')) {
                    fixedHeaderOffset = $('.page-header').outerHeight(true);
                }
            } else if ($('.page-header').hasClass('navbar-fixed-top')) {
                fixedHeaderOffset = $('.page-header').outerHeight(true);
            } else if ($('body').hasClass('page-header-fixed')) {
                fixedHeaderOffset = 64; // admin 5 fixed height
            }
            var table = $('#datatable-responsive');
            var oTable = $('#datatable-responsive').DataTable({
                fixedHeader: {
                    header: true,
                    headerOffset: fixedHeaderOffset
                },
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": '/ajax/get-users',
                responsive: {
                    details: {}
                },
                "iDisplayLength": 20,
                "lengthMenu": [
                    [20, 500, 1000, -1],
                    [20, 500, 1000, "All"] // change per page values here
                ],
                "order": [[0, "asc"]],
                "columnDefs": [
                    {"width": "40%", "targets": 0},
                    {"width": "40%", "targets": 1},
                    {"width": "10%", "targets": 2},
                    {"width": "10%", "targets": 3},
                    {className: "align-left", "targets": 0}
                ]
            });


            $('#addUserBtn').click(function(){
                $btn = $(this)[0]
                $firstName = $('#firstName').val();
                $lastName = $('#lastName').val();
                $email = $('#email').val();
                $password = $('#password').val();
                if($('#enabled').is(':checked') == true){
                    $isActive = 1;
                }else{
                    $isActive = 0;
                }


                $data = {
                    firstName: $firstName,
                    lastName: $lastName,
                    email: $email,
                    password: $password,
                    enabled: $isActive
                }

                addUser($btn, $data);

            });


            $('#editUserBtn').click(function(){
                $btn = $(this)[0]
                $uid = $('#editUid').val();
                $firstName = $('#editFirstName').val();
                $lastName = $('#editLastName').val();
                $email = $('#editEmail').val();
                $password = $('#editPassword').val();
                if($('#editEnabled').is(':checked') == true){
                    $isActive = 1;
                }else{
                    $isActive = 0;
                }


                $data = {
                    uid: $uid,
                    firstName: $firstName,
                    lastName: $lastName,
                    email: $email,
                    password: $password,
                    enabled: $isActive
                }

                editUser($btn, $data);

            });


            $('#deleteUserBtn').click(function(){
                $btn = $(this)[0]
                $uid = $('#deleteUid').val();
                $data = {
                    uid: $uid
                }

                deleteUser($btn, $data);

            });

        });




        function pushData(elem){
            $action = $(elem).data('action');
            $id = $(elem).data('id');
            $firstName = $(elem).data('first-name');
            $lastName = $(elem).data('last-name');
            $email = $(elem).data('email');
            $password = $(elem).data('password');
            $isActive = $(elem).data('is-active');


            if($action == 'edit'){
                $('#editUid').val($id);
                $('#editFirstName').val($firstName);
                $('#editLastName').val($lastName);
                $('#editEmail').val($email);
                $('#editPassword').val($password);
                if($isActive == 1){
                    $("input[type=checkbox]#editEnabled").bootstrapSwitch('state', true, true);
                }else{
                    $("input[type=checkbox]#editEnabled").bootstrapSwitch('state', false, true);
                }
            }else if($action == 'delete'){
                $('#deleteUid').val($id);
                $('#userDeleteName').html($firstName + ' ' + $lastName);
            }

        }


    </script>

    <!-- AJAX CALLS -->
    <script src="{{ asset('assets/ajax/users/ajax-login.js') }}" type="text/javascript"></script>
    <!-- END AJAX CALLS -->
{% endblock %}
